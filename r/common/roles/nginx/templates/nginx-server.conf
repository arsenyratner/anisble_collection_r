{% if server.beforeoptions is defined %}
{{ server.beforeoptions }}
{% endif %}
server {
  server_name {{ server.server_name }}{% if server.aliases is defined %} {{ server.aliases | join(' ') }}{% endif %};
{% for listen in server.listens %}
  listen {{ listen }};
{% endfor %}
{% if nginx_server_cert_file != "" and nginx_server_key_file != "" %}
{% if server.hsts | default(true) %}
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
{% endif %}
  ssl_certificate {{ nginx_server_cert_file }}; 
  ssl_certificate_key {{ nginx_server_key_file }}; 
{% endif %}
{% if nginx_server_accesslog_file != "" %}
  access_log {{ nginx_server_accesslog_file }} main;
{% endif %}
{% if nginx_server_errorlog_file != "" %}
  error_log {{ nginx_server_errorlog_file }};
{% endif %}
  error_page   500 502 503 504  /50x.html;
  location = /50x.html {
    root   html;
  }
{% if server.root is defined %}
  ## root dir
  root {{ server.root }};
{% endif %}
{% if server.shared_wellknown | default(true) is true %}
  ## well-known dir
  include well-known.conf;
{% endif %}
{% if server.snippets | default(false) %}
  ## snippets
  include {{ nginx_snippet_dir }}/*.conf;
{% endif %}
{% if server.redirect_to_https | default(false) %}
  ## redirect http to https
  if ($scheme = http) {
      return 301 https://$host$request_uri;
  }
{% endif %}
{% if server.otheroptions is defined %}
  ## otheroptions
  {{ server.otheroptions | indent(2) }}
{%- endif %}
{% if server.includes is defined -%}
  ## includes
{% for include in server.includes -%}
  {{ server.includes | indent(2) }}
{% endfor %}
{% endif %}
{% if server.locations is defined %}
  ## locations
{% for location in server.locations %}
  location {{ location.location }} {
  {% if location.alias is defined %}
    alias {{ location.alias }};
  {% endif %}
  {% if location.options is defined -%}
    {{ location.options | indent(4) }}
  {%- endif %}
  }
{% endfor %}
{% endif %}
}
